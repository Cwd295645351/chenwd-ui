# pnpm å®ç° monorepo

`pnpm` æ”¯æŒ `monorepo` çš„å·¥ä½œæœºåˆ¶å«åš[workspace(å·¥ä½œç©ºé—´)](https://pnpm.io/zh/workspaces)

å®ƒè¦æ±‚åœ¨ä»£ç ä»“çš„æ ¹ç›®å½•ä¸‹å­˜æœ‰ `pnpm-workspace.yaml` æ–‡ä»¶æŒ‡å®šå“ªäº›ç›®å½•ä½œä¸ºç‹¬ç«‹çš„å·¥ä½œç©ºé—´ï¼Œè¿™ä¸ªå·¥ä½œç©ºé—´å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­æ¨¡å—æˆ–è€… npm åŒ…ã€‚

ä¾‹å¦‚ä»¥ä¸‹çš„ `pnpm-workspace.yaml` æ–‡ä»¶å®šä¹‰ï¼š`a` ç›®å½•ã€`b` ç›®å½•ã€`c` ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼Œéƒ½ä¼šå„è‡ªè¢«è§†ä¸ºç‹¬ç«‹çš„æ¨¡å—ã€‚

```yaml
packages:
    - a
    - b
    - c/*
```

```js
ğŸ“¦my-project
 â”£ ğŸ“‚a
 â”ƒ â”— ğŸ“œpackage.json
 â”£ ğŸ“‚b
 â”ƒ â”— ğŸ“œpackage.json
 â”£ ğŸ“‚c
 â”ƒ â”£ ğŸ“‚c-1
 â”ƒ â”ƒ â”— ğŸ“œpackage.json
 â”ƒ â”£ ğŸ“‚c-2
 â”ƒ â”ƒ â”— ğŸ“œpackage.json
 â”ƒ â”— ğŸ“‚c-3
 â”ƒ   â”— ğŸ“œpackage.json
 â”£ ğŸ“œpackage.json
 â”£ ğŸ“œpnpm-workspace.yaml
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpnpm å¹¶ä¸æ˜¯é€šè¿‡ç›®å½•åç§°ï¼Œè€Œæ˜¯é€šè¿‡ç›®å½•ä¸‹ package.json æ–‡ä»¶çš„ name å­—æ®µæ¥è¯†åˆ«ä»“åº“å†…çš„åŒ…ä¸æ¨¡å—çš„ã€‚

## ä¸€ã€ ä¸­æ¢ç®¡ç†æ“ä½œ

å®‰è£…å’Œå¸è½½ä¾èµ–æ—¶ï¼Œ `-w` é€‰é¡¹è¡¨ç¤ºåœ¨ `monorepo` æ¨¡å¼ä¸‹çš„æ ¹ç›®å½•è¿›è¡Œæ“ä½œ

å®‰è£…å…¬å…±å¼€å‘ä¾èµ–

```bash
pnpm install -wD xxx
```

å¸è½½ä¾èµ–

```bash
pnpm uninstall -w xxx
```

## äºŒã€å­åŒ…ç®¡ç†æ“ä½œ

åœ¨ `workspace` æ¨¡å¼ä¸‹ï¼Œ`pnpm` ä¸»è¦é€šè¿‡ `--filter` é€‰é¡¹è¿‡æ»¤å­æ¨¡å—ï¼Œå®ç°å¯¹å„ä¸ªå·¥ä½œç©ºé—´è¿›è¡Œç²¾ç»†åŒ–æ“ä½œçš„ç›®çš„ã€‚

1. ä¸ºæŒ‡å®šæ¨¡å—å®‰è£…å¤–éƒ¨ä¾èµ–

```bash
# ä¸º a æ¨¡å—å®‰è£… lodash
pnpm --filter a install -S lodash
pnpm --filter a install -D lodash
```

2. æŒ‡å®šå†…éƒ¨æ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾èµ–

æŒ‡å®šæ¨¡å—ä¹‹é—´çš„äº’ç›¸ä¾èµ–ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†ä¸º `a` åŒ…å®‰è£…å†…éƒ¨ä¾èµ– `b`ã€‚

```bash
# æŒ‡å®š a æ¨¡å—ä¾èµ–äº b æ¨¡å—
pnpm --filter a install -S b
```

æ­¤æ—¶å†…éƒ¨æ¨¡å— a çš„ package å¦‚ä¸‹ï¼š

```json
{
	"name": "a",
	// ...
	"dependencies": {
		"b": "workspace:^"
	}
}
```
